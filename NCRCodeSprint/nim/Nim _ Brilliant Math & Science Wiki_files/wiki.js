require=function i(t,n,e){function o(c,r){if(!n[c]){if(!t[c]){var s="function"==typeof require&&require;if(!r&&s)return s(c,!0);if(a)return a(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[c]={exports:{}};t[c][0].call(l.exports,function(i){var n=t[c][1][i];return o(n?n:i)},l,l.exports,i,t,n,e)}return n[c].exports}for(var a="function"==typeof require&&require,c=0;c<e.length;c++)o(e[c]);return o}({1:[function(i){var t=i("jquery"),n=i("app/generic_controllers");t(function(){n.initGenericControllers()})},{"app/generic_controllers":"app/generic_controllers",jquery:"jquery"}],"app/wiki":[function(i,t){var n,e,o,a=i("jquery"),c=i("underscore"),r=i("util/global"),s=i("util/ui"),d=i("app/content_modal"),l=i("util/sticky"),u=i("util/ajax"),f=i("util/latex"),m=i("util/autosave"),h=i("util/analytics"),p={},g=function(i){e||(e=a.id("outdated-wiki-modal")),c.defer(function(){i.find("textarea").on("input",c.once(function(){var t=i.data(),o=t.autosaveUser+"_"+t.autosaveKey,c=m.getEditHash(o),r=function(){a.get(t.hashUrl).then(function(i){i.summary_hash&&i.summary_hash!=c&&(e.modal(),m.discardEdit(o),clearTimeout(n))}),n=setTimeout(r,3e4)};r()}))}),e.find(".discard-btn").on("click",function(){window.location.reload()})},v=function(i){var t=i.parents("form"),e=t.find(".preview-button"),c=function(){t.hasClass("summary-text-editor")&&a(".wiki-main-column").removeClass("editing"),e.val(""),t.submit()};if(n){o||(o=a.id("save-outdated-wiki-modal")),clearTimeout(n);var r=i.data(),s=r.autosaveUser+"_"+r.autosaveKey,d=m.getEditHash(s);a.get(r.hashUrl).then(function(i){i.summary_hash&&i.summary_hash!=d?o.modal():c()}),o.find(".save-btn").on("click",c)}else c()};p.editSummary=function(i){var t;i.data("is-logged-out")?t=function(){a(".signup-modal").removeClass("hide")}:(t=function(){a(".wiki-main-column").addClass("editing");var i=a(".edit-summary-container").data();u(i.pageKey).get(i.url,{component_key:i.componentKey})},a(".summary").mathjax_update()),i.on("click",t)};var k=function(i,t){var n,e=30,o=30,a=[],c=!1,r=function(i){var t=0;return i.forEach(function(i){t+=i}),t/i.length};i.on("keydown.timecheck",function(){n=(new Date).getTime()}),i.on("input.timecheck",function(){if(n){var s=(new Date).getTime();if(a.length>=e&&a.shift(),a.push(s-n),!c&&a.length>=e){var d=r(a);d>=o&&(c=!0,i.off(".timecheck"),h.track("ui",{element_id:"input_timings_wiki",path:window.location.pathname,input_timing_avg:Math.round(d),input_timing_content_length:i.val().length,input_timing_form_type:t,input_timing_threshold:o}))}}})};p.editSummaryForm=function(i){var t=i.data(),n=t.isPreview,e=t.hasErrors,o=t.isUnchanged,c=a(".wiki-main-column"),r=a.id("summary_text_editor"),s=r.find(".button-container"),d=r.find("textarea"),u=a.id("summary_text_preview"),f=u.find(".button-container"),m=r.find(".preview-button"),h=r.find(".cancel-button"),p=u.find(".edit-button"),_=u.find(".save-button"),w=function(){d.autosize().wikiLinks(!0),l.stick(s,{bottom:s.offset().top+i.outerHeight()}),k(d,"wiki_summary")},y=function(){a.window.scrollTop(0),u.mathjax_update(),setTimeout(function(){l.stick(f,{bottom:f.offset().top+i.outerHeight()})},100),d.wikiLinks()};n||e||o?n?y():o&&c.removeClass("editing"):(w(),g(r)),m.on("click",function(){_.val("")}),h.on("click",function(){c.removeClass("editing")}),p.on("click",function(){i.addClass("editing"),a.window.scrollTop(0),w()}),_.on("click",function(){v(r)})},p.editSection=function(i){var t=i.data(),n=t.id,e=t.heading,o=a.id("wiki-sidebar"),r=a.id("section-"+n),s=r.find(".edit-section-container"),d=s.data(),l=a.id("edit-another-section-modal"),f=function(){if(r.length&&o.length){var i=o.offset().top+o.outerHeight();r.offset().top<i&&o.addClass("hide")}r.addClass("editing"),s.addClass("cmp_"+d.componentKey+"_id"),u(d.pageKey).get(d.url,{component_key:d.componentKey,heading:e})};i.on("click",function(){if(a(".cmp_wiki_canonical_edit_section_id").length){var i=a(".cmp_wiki_canonical_edit_section_id").find("#id_old_heading").val(),t=c.template(a.id("discard-changes-text").text());l.find(".modal-body").html(t({currentHeading:i,buttonHeading:e})),l.modal(),l.find(".discard-btn").on("click",function(){var i=a(".cmp_wiki_canonical_edit_section_id"),t=i.parent(".section"),n=t.prev(".skill-heading");i.removeClass("cmp_wiki_canonical_edit_section_id"),t.removeClass("editing"),n.removeClass("hide"),f()})}else f()})},p.editSectionForm=function(i){var t=i.data(),n=t.isPreview,e=t.isUnchanged,o=i.parents(".section"),a=o.prev(".skill-heading"),c=i.parent(".edit-section-container"),r=i.find(".section-text-editor"),s=i.children(".button-container"),d=r.find(".autosave-field"),u=r.find("textarea"),f=i.find(".section-preview"),m=f.find(".button-container"),h=i.find(".preview-button"),p=i.find(".cancel-button"),_=i.find(".edit-button"),w=i.find(".save-button"),y=function(){o.addClass("editing"),a.addClass("hide"),u.autosize().wikiLinks(!0),l.stick(s,{bottom:s.offset().top+i.outerHeight()}),k(u,"wiki_section")},b=function(){f.mathjax_update(),setTimeout(function(){l.stick(m,{bottom:m.offset().top+i.outerHeight()})},100),u.wikiLinks()},C=function(){c.removeClass("cmp_wiki_canonical_edit_section_id"),o.removeClass("editing"),a.removeClass("hide")};n||e?n?b():e&&C():(y(),g(d)),h.on("click",function(){w.val(""),i.removeClass("editing")}),p.on("click",function(){C()}),_.on("click",function(){i.addClass("editing"),u.autosize().wikiLinks(),l.stick(s,{bottom:s.offset().top+i.outerHeight()})}),w.on("click",function(){v(d)})},p.expandOrCollapse=function(i){var t=i.find("header"),n=i.attr("id"),e=window.location.hash.substr(1);t.on("click",function(){var t=i.next(".section");i.hasClass("collapsed")?(i.removeClass("collapsed"),t.removeClass("collapsed"),f.checkOverflow(t)):(i.addClass("collapsed"),t.addClass("collapsed"))});var o=function(){t.trigger("click"),c.delay(function(){s.Anchors.scrollToTarget(t)},100)};r.is_mobile&&e===n&&o()},p.summary=function(i){i.find(".load-modal").each(function(){if(r.is_native){var i=a(this).find(".modal-link"),t=i.attr("href");t+=-1===t.indexOf("?")?"?":"&",t+="newwindow=true",i.attr("href",t).attr("target","")}else d.modal_events.apply(this,arguments),f.checkOverflow(a(this))});var t=a(".skill-heading");r.is_mobile&&1==t.length&&c.defer(function(){t.find("header").trigger("click")});var n=function(){var i=window.location.hash;"citation-"==i.substr(1,9)&&a.id(i.substr(1)).addClass("highlight-citation")};n(),a(".citation-link").on("click",function(){c.defer(n)})},p.rateWiki=function(i){var t=i.find("li"),n=i.data("rating"),e=!1;n?t.find("input[value="+n+"]").parents("li").addClass("selected"):t.on("click",function(){var n=a(this);e||(e=!0,t.find("input:checked").prop("checked",!1),n.addClass("selected"),n.find("input").prop("checked",!0),i.submit())})},p.reportDisputedWiki=function(i){var t=i.find("#submit");t.on("click",function(){i.submit(),a(".disputed-container").addClass("hide")})},p.confirmModeratorAction=function(i){i.on("click",function(){var t=i.data(),n=a("#"+t.logId),e=a("#wiki-logs-confirm").prop("checked");e?a.confirm(t.confirm_msg,function(e){e&&(n.val(t.value),i.parents("form").submit())}):(n.val(t.value),i.parents("form").submit())})},p.logsPager=function(i){i.on("click",function(){var t=i.data("page");a("#pagination_page_id").val(t),i.parents("form").submit()})},p.showStaffActions=function(i){var t=a(".wiki-staff-container"),n=a(".wiki-overlay");i.on("click",function(i){i.stopPropagation(),t.show(),n.show()}),a("body").on("click",function(){t.hide(),n.hide()}),t.on("click",function(i){i.stopPropagation()})},p.difficultySelector=function(i){var t=i.data();i.find("a").on("click",function(){var i=a(this).data("value");u(t.pageKey).get(t.url,{component_key:t.componentKey,community_post_difficulty:i})})},p.feedback=function(i){var t=a.id("wiki-feedback-trigger"),n="active",e=i.hasClass(n),o=function(t,o){e=!e,e&&(o!==!0&&s.Anchors.scrollToTarget(i),i.find(".cmp-deferred").each(function(){u.deferred.load(a(this))})),i.toggleClass(n,e)};t.on("click",o),-1!==window.location.hash.indexOf("feedback")&&o(null,!0)},p.getCitationTime=function(i){var t=c.template(a.id("retrieval-time-content").text()),n=new Date,e=["January","February","March","April","May","June","July","August","September","October","November","December"];i.find(".retrieval-time").html(t({hour:("0"+n.getHours()).slice(-2),minute:("0"+n.getMinutes()).slice(-2),month:e[n.getMonth()],day:n.getDate(),year:n.getFullYear()}))},p.quizFooter=function(i){var t=a.id("footer").outerHeight();t&&c.defer(function(){var n=0;a.window.on("scroll",c.throttle(function(){var e=a.window.scrollTop()-(a.body.scrollHeight()-t-a.window.height());e>0?i.css({transform:"translate(0, -"+e+"px)"}):n>0&&i.css({transform:"translate(0, 0)"}),n=e},16))});var n=i.data("ax-id");n&&c.defer(function(){h.track("ui",{element_id:n,path:window.location.pathname,full_path:window.location.pathname+window.location.search})})},p.examplesContribModal=function(i){i.modal()},t.exports=p},{"app/content_modal":"app/content_modal",jquery:"jquery",underscore:"underscore","util/ajax":"util/ajax","util/analytics":"util/analytics","util/autosave":"util/autosave","util/global":"util/global","util/latex":"util/latex","util/sticky":"util/sticky","util/ui":"util/ui"}]},{},[1]);
//# sourceMappingURL=wiki.js.map
